# Guia de Desenvolvimento - Chefia POS

## üìã Sum√°rio

1. [Antes de Come√ßar](#antes-de-come√ßar)
2. [Padr√µes de C√≥digo](#padr√µes-de-c√≥digo)
3. [Estrutura de Pastas](#estrutura-de-pastas)
4. [Workflow de Desenvolvimento](#workflow-de-desenvolvimento)
5. [Commits e Versionamento](#commits-e-versionamento)
6. [Testes](#testes)
7. [Documenta√ß√£o](#documenta√ß√£o)
8. [Valida√ß√£o e QA](#valida√ß√£o-e-qa)
9. [Deploy e Release](#deploy-e-release)
10. [Troubleshooting](#troubleshooting)

---

## üöÄ Antes de Come√ßar

### Checklist Inicial

```markdown
- [ ] Ambiente de desenvolvimento configurado
- [ ] Acesso ao reposit√≥rio git
- [ ] Docker e Docker Compose instalados
- [ ] Node.js 20+ e Python 3.11+ instalados
- [ ] IDE configurado (VSCode recomendado)
- [ ] Extens√µes necess√°rias instaladas
- [ ] Pre-commit hooks configurados
- [ ] Leu a documenta√ß√£o existente
- [ ] Entendeu a arquitetura do sistema
```

### Setup do Ambiente

```bash
# 1. Clone o reposit√≥rio
git clone <repository-url>
cd chefia-pos

# 2. Setup Backend
cd src/
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate      # Windows
pip install -r requirements.txt
pip install -r requirements-dev.txt

# 3. Setup Frontend
cd ../frontend/
npm install

# 4. Setup Infrastructure
cd ..
docker-compose up -d

# 5. Configure pre-commit hooks
pre-commit install

# 6. Verify setup
make test  # ou npm test && pytest
```

### Configura√ß√£o do IDE (VSCode)

`.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.organizeImports": true
  },
  "python.linting.enabled": true,
  "python.linting.pylintEnabled": false,
  "python.linting.flake8Enabled": true,
  "python.formatting.provider": "black",
  "typescript.preferences.importModuleSpecifier": "relative",
  "files.exclude": {
    "**/__pycache__": true,
    "**/*.pyc": true,
    "**/node_modules": true,
    "**/.pytest_cache": true
  }
}
```

---

## üèÜ Padr√µes de Qualidade e Code Quality (SonarLint)

### üìä M√©tricas de Qualidade

O projeto segue padr√µes rigorosos de qualidade baseados em an√°lises est√°ticas do SonarQube/SonarLint:

- **Code Coverage**: M√≠nimo 70% para produ√ß√£o
- **Duplica√ß√£o**: M√°ximo 3% de c√≥digo duplicado
- **Complexidade Ciclom√°tica**: M√°ximo 15 por m√©todo/fun√ß√£o
- **Technical Debt**: M√°ximo 5% do tempo total de desenvolvimento

### üéØ Regras de Code Quality Implementadas

#### 1. Substitui√ß√£o de console.\* por Logging Centralizado

```typescript
// ‚ùå Antes: Console statements espalhados
console.log("Processing order:", order);
console.error("Error:", error);
console.warn("Warning: Invalid data");

// ‚úÖ Depois: Logging centralizado com contexto
import { offlineStorage } from "@/services/offlineStorage";

// Para informa√ß√µes/debug
offlineStorage.log("Processing order", {
  orderId: order.id,
  status: order.status,
});

// Para erros (automaticamente inclui stack trace)
offlineStorage.log("Failed to process order", error);

// Para warnings com contexto
offlineStorage.log("Warning: Invalid data detected", {
  data,
  validation: "missing required fields",
});
```

#### 2. Elimina√ß√£o de TypeScript 'any' Types

```typescript
// ‚ùå Antes: Tipos 'any' gen√©ricos
function processData(data: any): any {
  return data.map((item: any) => item.value);
}

// ‚úÖ Depois: Tipos espec√≠ficos e seguros
interface DataItem {
  id: string;
  value: number;
  status: "active" | "inactive";
}

interface ProcessedData {
  processedValues: number[];
  totalCount: number;
}

function processData(data: DataItem[]): ProcessedData {
  const processedValues = data.map((item) => item.value);
  return {
    processedValues,
    totalCount: data.length,
  };
}
```

#### 3. Tratamento Robusto de Erros (Elimina√ß√£o de Empty Catch Blocks)

```typescript
// ‚ùå Antes: Catch blocks vazios
try {
  const result = await api.getRemoteOrders();
  setOrders(result);
} catch (error) {
  // Silencioso - problema cr√≠tico!
}

// ‚úÖ Depois: Tratamento completo de erros
try {
  const result = await api.getRemoteOrders();
  setOrders(result);
} catch (error: unknown) {
  // Log estruturado do erro
  offlineStorage.log("Failed to fetch remote orders", {
    error: error instanceof Error ? error.message : String(error),
    timestamp: new Date().toISOString(),
    context: "RemoteOrdersPage.fetchOrders",
  });

  // Feedback ao usu√°rio
  addToast("Erro ao carregar pedidos remotos", "error");

  // Fallback graceful
  setOrders([]);
}
```

#### 4. Extra√ß√£o de Nested Ternary Operations

```typescript
// ‚ùå Antes: Nested ternary ileg√≠vel
const statusIcon =
  order.status === "pending"
    ? "‚è≥"
    : order.status === "confirmed"
    ? "‚úÖ"
    : order.status === "preparing"
    ? "üî•"
    : order.status === "ready"
    ? "üì¶"
    : "‚ùå";

// ‚úÖ Depois: Fun√ß√£o pura e test√°vel
function getOrderStatusIcon(status: OrderStatus): string {
  const iconMap: Record<OrderStatus, string> = {
    pending: "‚è≥",
    confirmed: "‚úÖ",
    preparing: "üî•",
    ready: "üì¶",
    cancelled: "‚ùå",
  };

  return iconMap[status] || "‚ùì";
}

const statusIcon = getOrderStatusIcon(order.status);

// ‚úÖ Alternativa: IIFE para l√≥gica inline complexa
const statusColor = (() => {
  switch (order.status) {
    case "pending":
      return "bg-yellow-100 text-yellow-800";
    case "confirmed":
      return "bg-green-100 text-green-800";
    case "preparing":
      return "bg-blue-100 text-blue-800";
    default:
      return "bg-gray-100 text-gray-800";
  }
})();
```

#### 5. Melhorias de Acessibilidade (Semantic HTML)

```typescript
// ‚ùå Antes: div com onClick (n√£o acess√≠vel)
<div
  onClick={handleOrderClick}
  className="cursor-pointer hover:bg-gray-50"
>
  Order #{order.id}
</div>

// ‚úÖ Depois: button sem√¢ntico com acessibilidade
<button
  onClick={handleOrderClick}
  type="button"
  className="w-full text-left p-4 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
  aria-label={`View details for order ${order.id}`}
>
  Order #{order.id}
</button>

// ‚úÖ Labels com htmlFor adequados
<label
  htmlFor="order-notes"
  className="block text-sm font-medium text-gray-700 mb-1"
>
  Observa√ß√µes do Pedido
</label>
<textarea
  id="order-notes"
  value={notes}
  onChange={(e) => setNotes(e.target.value)}
  className="w-full border border-gray-300 rounded-md px-3 py-2"
  placeholder="Digite observa√ß√µes especiais..."
/>
```

#### 6. Centraliza√ß√£o de Configura√ß√£o de API

```typescript
// ‚ùå Antes: URLs hardcoded espalhadas
// Em v√°rios arquivos:
fetch("http://localhost:8001/api/v1/orders");
fetch("http://localhost:8001/api/v1/remote-orders");
fetch("http://localhost:8001/api/v1/products");

// ‚úÖ Depois: config/api.ts centralizado
// config/api.ts
export const API_CONFIG = {
  BASE_URL: process.env.REACT_APP_API_URL || "http://localhost:8001",
  TIMEOUT: 30000,
  RETRY_ATTEMPTS: 3,
  ENDPOINTS: {
    ORDERS: "/api/v1/orders",
    REMOTE_ORDERS: "/api/v1/remote-orders",
    PRODUCTS: "/api/v1/products",
    CUSTOMERS: "/api/v1/customers",
  },
} as const;

// services/apiClient.ts
import { API_CONFIG } from "@/config/api";

export class ApiClient {
  private baseURL = API_CONFIG.BASE_URL;

  async get<T>(endpoint: string): Promise<T> {
    const response = await fetch(`${this.baseURL}${endpoint}`, {
      headers: { "Content-Type": "application/json" },
    });

    if (!response.ok) {
      throw new Error(`API Error: ${response.status} ${response.statusText}`);
    }

    return response.json();
  }
}

// Uso nos components
const orders = await apiClient.get<Order[]>(API_CONFIG.ENDPOINTS.ORDERS);
```

#### 7. Cache para Preven√ß√£o de Duplicate API Calls

```typescript
// ‚ùå Antes: Multiple chamadas desnecess√°rias
useEffect(() => {
  fetchOrders(); // Chamada 1
}, []);

useEffect(() => {
  fetchOrders(); // Chamada 2 (duplicada)
}, [selectedPlatform]);

// ‚úÖ Depois: Cache inteligente com React Query
import { useQuery } from "@tanstack/react-query";

const {
  data: orders,
  isLoading,
  error,
} = useQuery({
  queryKey: ["orders", selectedPlatform],
  queryFn: () => orderService.getOrders({ platform: selectedPlatform }),
  staleTime: 5 * 60 * 1000, // Fresh por 5 minutos
  cacheTime: 10 * 60 * 1000, // Cache por 10 minutos
  retry: 2,
  refetchOnWindowFocus: false,
});

// ‚úÖ Alternativa: Cache manual simples
const orderCache = new Map<string, { data: Order[]; timestamp: number }>();
const CACHE_DURATION = 5 * 60 * 1000; // 5 minutos

async function getCachedOrders(platform: string): Promise<Order[]> {
  const cacheKey = `orders-${platform}`;
  const cached = orderCache.get(cacheKey);

  if (cached && Date.now() - cached.timestamp < CACHE_DURATION) {
    return cached.data;
  }

  const orders = await orderService.getOrders({ platform });
  orderCache.set(cacheKey, { data: orders, timestamp: Date.now() });

  return orders;
}
```

#### 8. Optional Chaining para Acesso Seguro

```typescript
// ‚ùå Antes: Acesso direto perigoso
const customerName = order.customer.name;
const firstItem = order.items[0].product.name;
const discountAmount = order.payment.discount.amount;

// ‚úÖ Depois: Optional chaining seguro
const customerName = order?.customer?.name ?? "Cliente n√£o identificado";
const firstItem = order?.items?.[0]?.product?.name ?? "Item n√£o encontrado";
const discountAmount = order?.payment?.discount?.amount ?? 0;

// ‚úÖ Com type guards para valida√ß√£o adicional
function isValidOrder(order: unknown): order is Order {
  return (
    typeof order === "object" &&
    order !== null &&
    "id" in order &&
    "status" in order &&
    "items" in order &&
    Array.isArray((order as any).items)
  );
}

if (isValidOrder(orderData)) {
  // orderData √© tipado como Order aqui
  const total = orderData.items.reduce((sum, item) => sum + item.price, 0);
}
```

### üîç Tools de Qualidade

```bash
# An√°lise de qualidade completa
npm run lint          # ESLint para padr√µes
npm run type-check     # TypeScript strict checking
npm run test:coverage  # Coverage de testes
npm run audit          # Vulnerabilidades de seguran√ßa

# SonarLint integration (VSCode)
# Instale a extens√£o SonarLint para an√°lise em tempo real

# Pre-commit hooks para garantir qualidade
npx husky add .husky/pre-commit "npm run lint && npm run type-check"
```

---

## üíª Padr√µes de C√≥digo

### ‚ö†Ô∏è REGRAS CR√çTICAS DE C√ìDIGO

#### üèÜ PADR√ïES DE QUALIDADE SONARQUBE/SONAR LINT

```typescript
// ‚úÖ PADR√ÉO: Usar logging centralizado ao inv√©s de console
// ‚ùå NUNCA deixe console.log/console.error
console.log("debug", data); // REMOVER ANTES DO COMMIT
console.warn("test"); // REMOVER ANTES DO COMMIT
console.error("check this"); // REMOVER ANTES DO COMMIT

// ‚úÖ SEMPRE use logging centralizado
import { offlineStorage } from "@/services/offlineStorage";

// Para logs de debug/info
offlineStorage.log("Order processed successfully", { orderId: data.id });

// Para erros (com stack trace)
try {
  processOrder(data);
} catch (error) {
  offlineStorage.log("Error processing order", error);
  // Handle error appropriately
}
```

#### ‚ùå PROIBIDO NO C√ìDIGO DE PRODU√á√ÉO

```python
# ‚ùå NUNCA deixe console.log/print de debug
print("debug:", data)  # REMOVER ANTES DO COMMIT

# ‚ùå NUNCA deixe mocks fora de testes
def get_user():
    # return {"id": 1, "name": "Mock User"}  # NUNCA FA√áA ISSO
    return database.get_user()  # Sempre use dados reais

# ‚ùå NUNCA ignore tipos/typing
def process_data(data):  # FALTA TIPO
    return data

# ‚úÖ SEMPRE use tipos
def process_data(data: Dict[str, Any]) -> ProcessedData:
    return ProcessedData(data)
```

```typescript
// ‚ùå NUNCA use any como tipo
let data: any;  // EVITE ANY
function process(input: any): any {  // TIPOS ESPEC√çFICOS

// ‚úÖ SEMPRE use tipos espec√≠ficos
interface OrderData {
  id: string;
  total: number;
  status: 'pending' | 'confirmed' | 'rejected';
}

let data: OrderData;
function process(input: OrderInput): OrderOutput {
  // Implementation
}

// ‚ùå NUNCA deixe dados mockados
const users = [
  { id: 1, name: 'Test User' }  // APENAS EM TESTES
];

// ‚úÖ Use servi√ßos reais ou factories
const users = await userService.getUsers();

// ‚ùå NUNCA deixe catch blocks vazios
try {
  const result = await api.getData();
} catch (error) {
  // Silencioso - NUNCA FA√áA ISSO!
}

// ‚úÖ SEMPRE trate erros adequadamente
try {
  const result = await api.getData();
} catch (error) {
  offlineStorage.log('Failed to fetch data', error);
  // Handle error: show notification, retry, etc.
  throw new Error('Unable to fetch data. Please try again.');
}
```

### Python (Backend)

#### Nomenclatura

```python
# ‚úÖ CORRETO
class OrderService:  # PascalCase para classes
    def calculate_total(self):  # snake_case para fun√ß√µes/m√©todos
        total_amount = 0  # snake_case para vari√°veis
        TAX_RATE = 0.18  # UPPER_CASE para constantes

# ‚ùå INCORRETO
class order_service:  # N√£o use snake_case para classes
    def CalculateTotal(self):  # N√£o use PascalCase para m√©todos
        TotalAmount = 0  # N√£o use PascalCase para vari√°veis
```

#### Imports

```python
# ‚úÖ CORRETO - Ordem dos imports
# 1. Standard library
import os
import sys
from datetime import datetime
from typing import List, Optional

# 2. Third-party
import pytest
from fastapi import FastAPI
from pydantic import BaseModel

# 3. Local application
from src.core.events import EventBus
from src.order.models import Order
from src.order.services import OrderService

# ‚ùå INCORRETO - Imports n√£o utilizados ou desordenados
from fastapi import *  # N√£o use wildcard imports
import unused_module  # Remova imports n√£o utilizados
```

#### Docstrings

```python
# ‚úÖ CORRETO
def calculate_discount(
    price: float,
    discount_percentage: float,
    max_discount: Optional[float] = None
) -> float:
    """
    Calculate discount amount for a given price.

    Args:
        price: Original price before discount
        discount_percentage: Discount percentage (0-100)
        max_discount: Maximum allowed discount amount

    Returns:
        Calculated discount amount

    Raises:
        ValueError: If discount_percentage is negative or > 100

    Example:
        >>> calculate_discount(100, 10)
        10.0
    """
    if not 0 <= discount_percentage <= 100:
        raise ValueError("Discount must be between 0 and 100")

    discount = price * (discount_percentage / 100)
    if max_discount:
        discount = min(discount, max_discount)

    return discount
```

### TypeScript/React (Frontend)

#### Nomenclatura

```typescript
// ‚úÖ CORRETO
interface OrderProps {
  // PascalCase para interfaces/types
  orderId: string; // camelCase para propriedades
  totalAmount: number;
}

const OrderComponent: FC<OrderProps> = ({ orderId, totalAmount }) => {
  const [isLoading, setIsLoading] = useState(false); // camelCase
  const MAX_ITEMS = 100; // UPPER_CASE para constantes

  const handleSubmit = useCallback(() => {
    // camelCase para fun√ß√µes
    // ...
  }, []);
};

// ‚ùå INCORRETO
interface order_props {
  // N√£o use snake_case
  OrderId: string; // N√£o use PascalCase para propriedades
}
```

#### Componentes React

```typescript
// ‚úÖ CORRETO - Componente bem estruturado
import React, { FC, memo, useCallback, useMemo } from "react";
import { useOrder } from "@/hooks/useOrder";
import { formatCurrency } from "@/utils/formatters";
import styles from "./Order.module.css";

interface OrderProps {
  orderId: string;
  onUpdate?: (order: Order) => void;
}

export const Order: FC<OrderProps> = memo(({ orderId, onUpdate }) => {
  // 1. Hooks
  const { order, loading, error } = useOrder(orderId);

  // 2. Computed values
  const formattedTotal = useMemo(
    () => (order ? formatCurrency(order.total) : "0"),
    [order]
  );

  // 3. Handlers
  const handleUpdate = useCallback(() => {
    if (order && onUpdate) {
      onUpdate(order);
    }
  }, [order, onUpdate]);

  // 4. Early returns
  if (loading) return <LoadingSpinner />;
  if (error) return <ErrorMessage error={error} />;
  if (!order) return null;

  // 5. Main render
  return (
    <div className={styles.order} data-testid={`order-${orderId}`}>
      <h2>Order #{order.number}</h2>
      <span>{formattedTotal}</span>
      <button onClick={handleUpdate}>Update</button>
    </div>
  );
});

Order.displayName = "Order";
```

### üéØ PADR√ïES DE C√ìDIGO QUALIDADE (SONAR COMPLIANCE)

#### Tratamento de Erros Centralizado

```typescript
// ‚úÖ PADR√ÉO: Tratamento de erro centralizado
import { offlineStorage } from "@/services/offlineStorage";

try {
  const orders = await remoteOrderService.getOrders();
  return orders;
} catch (error: unknown) {
  // Log centralizado com contexto
  offlineStorage.log("Failed to fetch remote orders", {
    error: error instanceof Error ? error.message : String(error),
    timestamp: new Date().toISOString(),
    context: "RemoteOrdersPage",
  });

  // Throw error espec√≠fico para tratamento upstream
  throw new Error("Unable to load orders. Please check your connection.");
}
```

#### Configura√ß√£o de API Centralizada

```typescript
// ‚úÖ PADR√ÉO: config/api.ts para centralizar URLs
// config/api.ts
export const API_CONFIG = {
  BASE_URL: process.env.REACT_APP_API_URL || "http://localhost:8001",
  ENDPOINTS: {
    ORDERS: "/api/v1/orders",
    REMOTE_ORDERS: "/api/v1/remote-orders",
    PRODUCTS: "/api/v1/products",
  },
  TIMEOUT: 30000,
};

// ‚ùå NUNCA hardcode URLs nos componentes
const response = await fetch("http://localhost:8001/api/v1/orders");

// ‚úÖ USE configura√ß√£o centralizada
import { API_CONFIG } from "@/config/api";
const response = await fetch(
  `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.ORDERS}`
);
```

#### Evitando Nested Ternary com IIFE

```typescript
// ‚ùå EVITE: Nested ternary dif√≠cil de ler
const statusColor =
  order.status === "pending"
    ? "yellow"
    : order.status === "confirmed"
    ? "green"
    : order.status === "preparing"
    ? "blue"
    : "red";

// ‚úÖ USE: IIFE (Immediately Invoked Function Expression) para l√≥gica complexa
const statusColor = (() => {
  switch (order.status) {
    case "pending":
      return "yellow";
    case "confirmed":
      return "green";
    case "preparing":
      return "blue";
    default:
      return "red";
  }
})();

// ‚úÖ OU: Extract para fun√ß√£o nomeada
function getStatusColor(status: OrderStatus): string {
  const colorMap: Record<OrderStatus, string> = {
    pending: "yellow",
    confirmed: "green",
    preparing: "blue",
    rejected: "red",
  };
  return colorMap[status] || "gray";
}

const statusColor = getStatusColor(order.status);
```

#### Acessibilidade com Elementos Sem√¢nticos

```typescript
// ‚ùå EVITE: div com onClick (n√£o √© acess√≠vel)
<div onClick={handleClick} className="clickable">
  Clique aqui
</div>

// ‚úÖ USE: button para a√ß√µes clic√°veis
<button
  onClick={handleClick}
  type="button"
  className="bg-blue-500 text-white px-4 py-2 rounded"
>
  Clique aqui
</button>

// ‚úÖ USE: htmlFor em labels
<label htmlFor="order-notes" className="block mb-2">
  Observa√ß√µes do Pedido
</label>
<textarea
  id="order-notes"
  value={notes}
  onChange={(e) => setNotes(e.target.value)}
  className="w-full border rounded px-3 py-2"
/>
```

#### Cache para Evitar Chamadas Duplicadas

```typescript
// ‚úÖ PADR√ÉO: Cache simples com Map
const orderCache = new Map<string, Order>();

const getOrder = async (orderId: string): Promise<Order> => {
  // Verificar cache primeiro
  if (orderCache.has(orderId)) {
    return orderCache.get(orderId)!;
  }

  try {
    const order = await api.getOrder(orderId);
    // Salvar no cache
    orderCache.set(orderId, order);
    return order;
  } catch (error) {
    offlineStorage.log("Failed to fetch order", { orderId, error });
    throw error;
  }
};

// ‚úÖ PADR√ÉO: React Query para cache autom√°tico (recomendado)
import { useQuery } from "@tanstack/react-query";

const {
  data: order,
  isLoading,
  error,
} = useQuery({
  queryKey: ["order", orderId],
  queryFn: () => orderService.getOrder(orderId),
  staleTime: 5 * 60 * 1000, // Cache por 5 minutos
  cacheTime: 10 * 60 * 1000, // Manter em cache por 10 minutos
});
```

#### Optional Chaining para Seguran√ßa

```typescript
// ‚ùå EVITE: Acesso direto que pode falhar
const customerName = order.customer.name;
const firstItemName = order.items[0].product.name;

// ‚úÖ USE: Optional chaining
const customerName = order?.customer?.name ?? "Cliente n√£o identificado";
const firstItemName =
  order?.items?.[0]?.product?.name ?? "Produto n√£o encontrado";

// ‚úÖ USE: Type guards para valida√ß√£o
function isValidOrder(order: any): order is Order {
  return (
    order &&
    typeof order.id === "string" &&
    Array.isArray(order.items) &&
    order.items.length > 0
  );
}

if (isValidOrder(order)) {
  // order √© tipado corretamente aqui
  const total = order.items.reduce((sum, item) => sum + item.price, 0);
}
```

### Limpeza de C√≥digo

```bash
# Backend - Remover imports n√£o utilizados
autoflake --in-place --remove-unused-variables src/**/*.py

# Frontend - Remover imports n√£o utilizados
eslint --fix src/**/*.{ts,tsx}

# Formata√ß√£o autom√°tica
black src/  # Python
prettier --write "frontend/**/*.{js,jsx,ts,tsx,css}"  # JavaScript/TypeScript
```

---

## üìÅ Estrutura de Pastas

### Backend

```
src/
‚îú‚îÄ‚îÄ <module_name>/           # M√≥dulo de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ models/              # Modelos de dados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain.py        # Domain models
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dto.py           # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ services/            # L√≥gica de neg√≥cio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ <module>_service.py
‚îÇ   ‚îú‚îÄ‚îÄ repositories/        # Acesso a dados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ <module>_repository.py
‚îÇ   ‚îú‚îÄ‚îÄ router/              # Endpoints API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ <module>_router.py
‚îÇ   ‚îú‚îÄ‚îÄ events/              # Event handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ <module>_events.py
‚îÇ   ‚îî‚îÄ‚îÄ tests/               # Testes do m√≥dulo
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ test_service.py
‚îÇ       ‚îî‚îÄ‚îÄ test_router.py
```

### Frontend

```
frontend/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îî‚îÄ‚îÄ <app_name>/          # Aplica√ß√£o espec√≠fica
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ components/  # Componentes da app
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ pages/       # P√°ginas/Rotas
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ hooks/       # Custom hooks
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ services/    # API services
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ utils/       # Utilidades
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ styles/      # Estilos
‚îÇ       ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ common/                  # C√≥digo compartilhado
‚îÇ   ‚îú‚îÄ‚îÄ components/          # Componentes reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ hooks/              # Hooks compartilhados
‚îÇ   ‚îú‚îÄ‚îÄ services/           # Services compartilhados
‚îÇ   ‚îú‚îÄ‚îÄ types/              # TypeScript types
‚îÇ   ‚îî‚îÄ‚îÄ utils/              # Utilidades compartilhadas
```

### Documenta√ß√£o

```
docs/
‚îú‚îÄ‚îÄ api/                     # Documenta√ß√£o de APIs
‚îÇ   ‚îú‚îÄ‚îÄ endpoints/          # Endpoints por m√≥dulo
‚îÇ   ‚îî‚îÄ‚îÄ schemas/            # Schemas JSON/OpenAPI
‚îú‚îÄ‚îÄ architecture/           # Diagramas e decis√µes
‚îú‚îÄ‚îÄ guides/                 # Guias e tutoriais
‚îú‚îÄ‚îÄ modules/                # Documenta√ß√£o por m√≥dulo
‚îî‚îÄ‚îÄ deployment/             # Guias de deploy
```

### Configura√ß√µes

```
config/
‚îú‚îÄ‚îÄ environments/           # Configs por ambiente
‚îÇ   ‚îú‚îÄ‚îÄ development.json
‚îÇ   ‚îú‚îÄ‚îÄ staging.json
‚îÇ   ‚îî‚îÄ‚îÄ production.json
‚îú‚îÄ‚îÄ docker/                 # Docker configs
‚îú‚îÄ‚îÄ nginx/                  # Nginx configs
‚îî‚îÄ‚îÄ README.md              # Documenta√ß√£o das configs
```

---

## üîÑ Workflow de Desenvolvimento

### üéØ REGRA DE OURO: FOCO E CONCLUS√ÉO

#### ‚ö†Ô∏è Princ√≠pio Fundamental: TERMINE O QUE COME√áOU

```markdown
‚ùå N√ÉO FA√áA ISSO:

- Come√ßar feature A
- "Funciona" mas tem bugs conhecidos
- "Deixa pra corrigir depois"
- Mudar para feature B
- Iniciar refactor C
- Voltar para A (bugs ainda l√° + novos problemas)
- Resultado: 3 tarefas "completas" mas quebradas

‚úÖ FA√áA ISSO:

- Come√ßar feature A
- Testar e encontrar bugs
- CORRIGIR todos os bugs ANTES de continuar
- CONCLUIR feature A 100% funcional
- Fazer commit/PR de A
- ENT√ÉO come√ßar pr√≥xima tarefa
- Resultado: 1 tarefa REALMENTE completa e est√°vel
```

#### üêõ REGRA DE OURO: Definition of Done

```markdown
Uma tarefa N√ÉO est√° completa at√© que:
‚úÖ C√≥digo implementado
‚úÖ ZERO bugs conhecidos
‚úÖ Todos os casos de testes da feature implementados e passando
‚úÖ Sem warnings/erros no console
‚úÖ Code review aprovado
‚úÖ Documenta√ß√£o atualizada
‚úÖ Funcionando em ambiente de dev/staging

‚ö†Ô∏è "Funciona mas tem um bugzinho" = N√ÉO EST√Å PRONTO
‚ö†Ô∏è "Depois eu corrijo" = N√ÉO FA√áA COMMIT
‚ö†Ô∏è "√â s√≥ um warning" = AINDA TEM PROBLEMA
```

#### M√©todo de Trabalho Focado

```markdown
1. ESCOLHA uma √∫nica tarefa
2. FOQUE nela at√© completar
3. TESTE o que foi feito
4. DOCUMENTE se necess√°rio
5. COMMIT com a tarefa completa
6. S√ì ENT√ÉO passe para a pr√≥xima

Exce√ß√µes permitidas:

- Bloqueio real (depend√™ncia externa, aprova√ß√£o, etc.)
- Bug cr√≠tico em produ√ß√£o (prioridade m√°xima)
- Mas sempre: anote onde parou e o que falta
```

### 1. Planejamento (TODO List)

**SEMPRE crie uma TODO list antes de come√ßar E SIGA A ORDEM:**

```markdown
## TODO: Implementar Sistema de Cupons

### EM PROGRESSO:

- [x] Analisar requisitos e criar design
- [ ] Criar models no backend ‚Üê TRABALHANDO NISSO AGORA

### PR√ìXIMAS (n√£o toque at√© terminar a atual):

- [ ] Implementar service layer
- [ ] Criar endpoints da API
- [ ] Adicionar testes unit√°rios
- [ ] Criar componente React
- [ ] Integrar com API
- [ ] Adicionar testes de integra√ß√£o
- [ ] Atualizar documenta√ß√£o
- [ ] Code review

REGRA: S√≥ marque como [x] quando 100% pronto
S√≥ mova para pr√≥xima quando atual estiver [x]
NUNCA avance com bugs pendentes!

### BUGS ENCONTRADOS (resolver ANTES de continuar):

üêõ Bug #1: Valida√ß√£o de desconto n√£o funciona com valor zero
Status: ‚ùå Pendente
üêõ Bug #2: Campo de data aceita valores inv√°lidos
Status: ‚úÖ Corrigido no commit abc123
```

#### Checklist de Conclus√£o de Tarefa

```markdown
Antes de marcar qualquer tarefa como completa, VERIFIQUE:

- [ ] Funcionalidade implementada conforme especifica√ß√£o
- [ ] ZERO bugs conhecidos (teste em diferentes cen√°rios)
- [ ] Testes unit√°rios escritos e passando
- [ ] Sem console.log, print ou debug code
- [ ] Sem warnings no terminal/console
- [ ] Testado manualmente em pelo menos 3 casos diferentes
- [ ] Edge cases tratados (null, undefined, arrays vazios, etc.)
- [ ] C√≥digo revisado por voc√™ mesmo
- [ ] Documenta√ß√£o/coment√°rios onde necess√°rio

‚ùå Se qualquer item acima n√£o estiver ‚úÖ, a tarefa N√ÉO est√° completa!
```

### 2. Desenvolvimento

#### Sistema de Uma Tarefa por Vez

```bash
# ‚úÖ WORKFLOW CORRETO
git checkout -b feature/coupon-model
# Trabalhe APENAS no model at√© estar 100% pronto
# Teste o model
# Commit quando COMPLETO
git add .
git commit -m "feat(coupon): implement coupon model with validation"

# AGORA sim, pr√≥xima parte
git checkout -b feature/coupon-service
# Trabalhe APENAS no service...

# ‚ùå WORKFLOW INCORRETO
git checkout -b feature/coupon-system
# Mudan√ßas em 10 arquivos diferentes
# Model incompleto, service pela metade, UI come√ßada
# 500 linhas de c√≥digo sem testar
# Um commit gigante com tudo misturado
```

```bash
# 1. Criar branch feature
git checkout -b feature/coupon-system

# 2. Desenvolver incrementalmente
# - Fa√ßa commits pequenos e frequentes
# - Teste localmente ap√≥s cada mudan√ßa
# - Mantenha a TODO list atualizada

# 3. Executar testes locais
make test  # ou
npm test && pytest

# 4. Verificar linting
make lint  # ou
npm run lint && flake8 src/
```

### 3. Gest√£o de Foco e Produtividade

#### T√©cnica Pomodoro Adaptada para Dev

```markdown
1. ESCOLHA uma √∫nica tarefa da TODO list
2. TRABALHE 25-45 minutos focado APENAS nela
3. COMMIT incremental (mesmo que parcial)
4. PAUSA 5-10 minutos
5. REPITA at√© tarefa estar 100% completa
6. S√ì ENT√ÉO mova para pr√≥xima tarefa

üö´ Durante o foco, IGNORE:

- Slack/Teams (exceto emerg√™ncias)
- Outras tarefas "r√°pidas"
- Refatora√ß√µes n√£o relacionadas
- Features "legais" que descobriu
```

#### Tracking de Progresso

```markdown
## Status da Tarefa Atual

**Tarefa**: Implementar modelo de cupons
**In√≠cio**: 10:00
**Estimativa**: 2 horas
**Status**: 60% completo

### Conclu√≠do:

- [x] Estrutura base do modelo
- [x] Valida√ß√µes de campos
- [x] M√©todos de c√°lculo

### Em progresso:

- [ ] Testes unit√°rios (fazendo agora)

### Bloqueios:

- Nenhum

### Pr√≥ximo commit em: 15 minutos
```

### 4. Padr√£o de Branch

```
main                    # Produ√ß√£o
‚îú‚îÄ‚îÄ develop            # Desenvolvimento
‚îÇ   ‚îú‚îÄ‚îÄ feature/xxx    # Nova funcionalidade
‚îÇ   ‚îú‚îÄ‚îÄ bugfix/xxx     # Corre√ß√£o de bug
‚îÇ   ‚îú‚îÄ‚îÄ hotfix/xxx     # Corre√ß√£o urgente
‚îÇ   ‚îî‚îÄ‚îÄ refactor/xxx   # Refatora√ß√£o

REGRA: Uma branch = Uma tarefa espec√≠fica
       N√£o misture features na mesma branch
```

### 4. Pull Request Template

```markdown
## Descri√ß√£o

Breve descri√ß√£o do que foi feito

## Tipo de Mudan√ßa

- [ ] Bug fix
- [ ] Nova feature
- [ ] Breaking change
- [ ] Documenta√ß√£o

## Como Testar

1. Passo 1
2. Passo 2
3. Resultado esperado

## Checklist

- [ ] C√≥digo segue os padr√µes do projeto
- [ ] Self-review realizado
- [ ] Testes adicionados/atualizados
- [ ] Documenta√ß√£o atualizada
- [ ] Sem warnings no console
- [ ] Lint passou sem erros
```

---

## üìù Commits e Versionamento

### Padr√£o de Mensagens de Commit

**Formato**: `<tipo>(<escopo>): <descri√ß√£o>`

#### Tipos de Commit

```bash
feat:     # Nova funcionalidade
fix:      # Corre√ß√£o de bug
docs:     # Documenta√ß√£o
style:    # Formata√ß√£o (n√£o afeta l√≥gica)
refactor: # Refatora√ß√£o de c√≥digo
perf:     # Melhoria de performance
test:     # Adi√ß√£o/corre√ß√£o de testes
build:    # Mudan√ßas no build/dependencies
ci:       # Mudan√ßas no CI/CD
chore:    # Outras mudan√ßas
```

#### Exemplos

```bash
# ‚úÖ BONS commits
git commit -m "feat(order): add coupon validation system"
git commit -m "fix(payment): correct tax calculation for services"
git commit -m "docs(api): update order endpoints documentation"
git commit -m "test(product): add unit tests for price calculation"
git commit -m "refactor(auth): simplify token validation logic"

# ‚ùå MAUS commits
git commit -m "fixed bug"  # Muito vago
git commit -m "WIP"        # N√£o espec√≠fico
git commit -m "updates"    # N√£o descreve o que foi feito
```

### Fluxo de Commit

```bash
# 1. Verificar mudan√ßas
git status
git diff

# 2. Adicionar arquivos
git add .  # ou arquivos espec√≠ficos

# 3. Verificar o que ser√° commitado
git diff --staged

# 4. Fazer commit com mensagem descritiva
git commit -m "feat(module): description of change"

# 5. Push para branch
git push origin feature/branch-name
```

### Versionamento Sem√¢ntico

```
MAJOR.MINOR.PATCH

1.0.0 ‚Üí 2.0.0  # Breaking change
1.0.0 ‚Üí 1.1.0  # Nova feature (backward compatible)
1.0.0 ‚Üí 1.0.1  # Bug fix
```

---

## üß™ Testes

### ‚ö†Ô∏è REGRAS IMPORTANTES PARA TESTES

#### Mocks - Use APENAS em Testes

```python
# ‚úÖ CORRETO - Mock apenas em arquivo de teste
# tests/test_order_service.py
from unittest.mock import Mock, patch

def test_order_creation():
    mock_db = Mock()
    mock_db.save.return_value = {"id": "123"}
    service = OrderService(db=mock_db)
    # ... teste continua

# ‚ùå INCORRETO - Mock em c√≥digo de produ√ß√£o
# src/order/service.py
class OrderService:
    def __init__(self):
        # NUNCA FA√áA ISSO EM PRODU√á√ÉO
        self.db = Mock()  # ‚ùå ERRADO!
        self.db.save.return_value = {"id": "fake"}
```

```typescript
// ‚úÖ CORRETO - Mock apenas em teste
// Order.test.tsx
jest.mock("@/services/orderService");
const mockOrderService = {
  getOrder: jest.fn().mockResolvedValue(mockOrder),
};

// ‚ùå INCORRETO - Mock em componente real
// Order.tsx
const Order = () => {
  // NUNCA FA√áA ISSO
  const mockData = { id: 1, name: "Test" }; // ‚ùå ERRADO!
  // USE DADOS REAIS
  const data = await orderService.getOrder(); // ‚úÖ CORRETO
};
```

### Estrat√©gia de Testes

```
Cobertura M√≠nima: 70%
- Unit Tests: 80% coverage
- Integration Tests: 60% coverage
- E2E Tests: Critical paths only
```

### Backend - Python

#### Teste Unit√°rio

```python
# tests/test_order_service.py
import pytest
from unittest.mock import Mock, patch
from src.order.services import OrderService
from src.order.models import Order, OrderItem

class TestOrderService:
    """Test suite for OrderService."""

    @pytest.fixture
    def order_service(self):
        """Create OrderService instance with mocked dependencies."""
        mock_repo = Mock()
        mock_event_bus = Mock()
        return OrderService(mock_repo, mock_event_bus)

    @pytest.fixture
    def sample_order(self):
        """Create sample order for testing."""
        return Order(
            id="123",
            items=[
                OrderItem(product_id="1", quantity=2, price=10.0),
                OrderItem(product_id="2", quantity=1, price=20.0)
            ],
            customer_id="cust-123"
        )

    @pytest.mark.asyncio
    async def test_calculate_total_success(self, order_service, sample_order):
        """Test successful total calculation."""
        # Arrange
        expected_total = 40.0

        # Act
        result = await order_service.calculate_total(sample_order)

        # Assert
        assert result == expected_total

    @pytest.mark.asyncio
    async def test_create_order_publishes_event(self, order_service):
        """Test that creating order publishes event."""
        # Arrange
        order_data = {"items": [], "customer_id": "123"}
        order_service.repository.create.return_value = Mock(id="order-123")

        # Act
        await order_service.create_order(order_data)

        # Assert
        order_service.event_bus.publish.assert_called_once()
        event = order_service.event_bus.publish.call_args[0][0]
        assert event.type == "order.created"
```

#### Teste de Integra√ß√£o

```python
# tests/test_order_integration.py
import pytest
from httpx import AsyncClient
from src.main import app

@pytest.mark.asyncio
async def test_create_order_endpoint():
    """Test order creation through API."""
    async with AsyncClient(app=app, base_url="http://test") as client:
        # Arrange
        order_data = {
            "items": [
                {"product_id": "1", "quantity": 2}
            ],
            "customer_id": "customer-123"
        }

        # Act
        response = await client.post("/api/v1/orders", json=order_data)

        # Assert
        assert response.status_code == 201
        data = response.json()
        assert "id" in data
        assert data["customer_id"] == "customer-123"
```

### Frontend - React/TypeScript

#### Teste de Componente

```typescript
// Order.test.tsx
import { render, screen, fireEvent, waitFor } from "@testing-library/react";
import { Order } from "./Order";
import { useOrder } from "@/hooks/useOrder";

// Mock do hook
jest.mock("@/hooks/useOrder");
const mockUseOrder = useOrder as jest.MockedFunction<typeof useOrder>;

describe("Order Component", () => {
  const defaultProps = {
    orderId: "123",
    onUpdate: jest.fn(),
  };

  beforeEach(() => {
    jest.clearAllMocks();
  });

  it("should render loading state", () => {
    mockUseOrder.mockReturnValue({
      order: null,
      loading: true,
      error: null,
    });

    render(<Order {...defaultProps} />);

    expect(screen.getByTestId("loading-spinner")).toBeInTheDocument();
  });

  it("should render order details", async () => {
    const mockOrder = {
      id: "123",
      number: "ORD-001",
      total: 99.9,
      items: [],
    };

    mockUseOrder.mockReturnValue({
      order: mockOrder,
      loading: false,
      error: null,
    });

    render(<Order {...defaultProps} />);

    await waitFor(() => {
      expect(screen.getByText("Order #ORD-001")).toBeInTheDocument();
      expect(screen.getByText("R$ 99,90")).toBeInTheDocument();
    });
  });

  it("should call onUpdate when button clicked", async () => {
    const mockOrder = { id: "123", total: 100 };
    mockUseOrder.mockReturnValue({
      order: mockOrder,
      loading: false,
      error: null,
    });

    render(<Order {...defaultProps} />);

    const updateButton = screen.getByText("Update");
    fireEvent.click(updateButton);

    await waitFor(() => {
      expect(defaultProps.onUpdate).toHaveBeenCalledWith(mockOrder);
    });
  });
});
```

#### Teste de Hook

```typescript
// useOrder.test.ts
import { renderHook, waitFor } from "@testing-library/react";
import { useOrder } from "./useOrder";
import * as orderService from "@/services/orderService";

jest.mock("@/services/orderService");

describe("useOrder Hook", () => {
  it("should fetch order on mount", async () => {
    const mockOrder = { id: "123", total: 100 };
    jest.spyOn(orderService, "getOrder").mockResolvedValue(mockOrder);

    const { result } = renderHook(() => useOrder("123"));

    expect(result.current.loading).toBe(true);

    await waitFor(() => {
      expect(result.current.loading).toBe(false);
      expect(result.current.order).toEqual(mockOrder);
    });
  });

  it("should handle error", async () => {
    const error = new Error("Failed to fetch");
    jest.spyOn(orderService, "getOrder").mockRejectedValue(error);

    const { result } = renderHook(() => useOrder("123"));

    await waitFor(() => {
      expect(result.current.loading).toBe(false);
      expect(result.current.error).toBe("Failed to fetch");
    });
  });
});
```

### Executando Testes

```bash
# Backend
pytest                          # Todos os testes
pytest src/order/              # Testes de um m√≥dulo
pytest -v                      # Verbose
pytest --cov=src               # Com coverage
pytest -k "test_create"        # Testes espec√≠ficos

# Frontend
npm test                       # Todos os testes
npm test Order                 # Arquivo espec√≠fico
npm test -- --coverage        # Com coverage
npm test -- --watch          # Watch mode

# E2E
npm run test:e2e              # Playwright tests
npm run test:e2e:ui          # Com interface
```

---

## üìö Documenta√ß√£o

### Onde Documentar

```
docs/
‚îú‚îÄ‚îÄ api/                      # Documenta√ß√£o de APIs
‚îÇ   ‚îî‚îÄ‚îÄ order_endpoints.md    # Endpoints do m√≥dulo de pedidos
‚îú‚îÄ‚îÄ modules/                  # Documenta√ß√£o de m√≥dulos
‚îÇ   ‚îî‚îÄ‚îÄ order_module.md       # L√≥gica de neg√≥cio de pedidos
‚îú‚îÄ‚îÄ guides/                   # Guias e tutoriais
‚îÇ   ‚îî‚îÄ‚îÄ setup_development.md  # Como configurar ambiente
‚îî‚îÄ‚îÄ architecture/             # Decis√µes arquiteturais
    ‚îî‚îÄ‚îÄ adr-001-event-bus.md  # Architecture Decision Record
```

### Formato de Documenta√ß√£o

#### API Documentation

````markdown
# Order API

## Create Order

Creates a new order in the system.

**Endpoint:** `POST /api/v1/orders`

**Headers:**

- `Authorization: Bearer {token}`
- `Content-Type: application/json`

**Request Body:**

```json
{
  "items": [
    {
      "product_id": "123",
      "quantity": 2,
      "notes": "No onions"
    }
  ],
  "customer_id": "customer-123",
  "table_number": 5
}
```
````

**Response (201 Created):**

```json
{
  "id": "order-456",
  "number": "ORD-2024-001",
  "status": "pending",
  "total": 45.9,
  "created_at": "2024-01-15T10:30:00Z"
}
```

**Error Responses:**

- `400 Bad Request`: Invalid input data
- `401 Unauthorized`: Missing or invalid token
- `404 Not Found`: Customer or product not found

````

#### Module Documentation

```markdown
# Order Module

## Overview
The Order module handles all order-related operations including creation,
updates, cancellation, and payment processing.

## Business Rules
1. Orders can only be created during business hours
2. Minimum order value is R$ 10.00
3. Orders auto-cancel after 2 hours without payment

## Architecture
```mermaid
graph LR
    API[Order API] --> Service[Order Service]
    Service --> Repo[Order Repository]
    Service --> Events[Event Bus]
    Repo --> DB[(Database)]
````

## Key Components

- **OrderService**: Business logic implementation
- **OrderRepository**: Data access layer
- **OrderEvents**: Event publishers and handlers

## Dependencies

- Product Module (for product validation)
- Payment Module (for payment processing)
- Customer Module (for customer data)

````

### Docstrings e Comments

```python
# ‚úÖ BOM - Docstring completa
class OrderService:
    """
    Service layer for order management.

    This service handles all business logic related to orders,
    including validation, calculation, and event publishing.

    Attributes:
        repository: Data access layer for orders
        event_bus: Event publishing interface
        validator: Order validation service
    """

    def calculate_discount(
        self,
        order: Order,
        coupon: Optional[Coupon] = None
    ) -> Decimal:
        """
        Calculate applicable discount for an order.

        Applies business rules for discount calculation including:
        - Coupon validation and application
        - Maximum discount limits
        - Product-specific discount restrictions

        Args:
            order: Order to calculate discount for
            coupon: Optional coupon to apply

        Returns:
            Total discount amount in currency

        Raises:
            InvalidCouponError: If coupon is expired or invalid
            DiscountLimitExceeded: If discount exceeds maximum allowed
        """
        # Implementation here
````

```typescript
// ‚úÖ BOM - JSDoc completo
/**
 * Order component for displaying and managing orders.
 *
 * @component
 * @example
 * <Order orderId="123" onUpdate={handleUpdate} />
 */
interface OrderProps {
  /** Unique identifier for the order */
  orderId: string;
  /** Callback fired when order is updated */
  onUpdate?: (order: Order) => void;
  /** Whether to show detailed view */
  detailed?: boolean;
}
```

---

## ‚úÖ Valida√ß√£o e QA

### Checklist Pr√©-Commit

```bash
#!/bin/bash
# pre-commit.sh - Execute antes de cada commit

echo "üîç Running pre-commit checks..."

# 1. Check for console.log/print statements
echo "Checking for debug statements..."
# Python
if grep -r "print(" src/ --include="*.py" | grep -v "# noqa" | grep -v "tests/"; then
    echo "‚ùå Found print() statements in production code!"
    exit 1
fi

# JavaScript/TypeScript
if grep -r "console\." frontend/ --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" | grep -v "// eslint-disable" | grep -v "tests/" | grep -v ".test."; then
    echo "‚ùå Found console statements in production code!"
    exit 1
fi

# 2. Check for Mock usage outside tests
echo "Checking for mocks in production..."
if grep -r "Mock\|mock" src/ --include="*.py" | grep -v "tests/" | grep -v "test_"; then
    echo "‚ùå Found Mock usage outside of tests!"
    exit 1
fi

if grep -r "jest\.mock\|mockImplementation\|mockReturnValue" frontend/ --include="*.ts" --include="*.tsx" | grep -v ".test." | grep -v ".spec."; then
    echo "‚ùå Found mock usage outside of tests!"
    exit 1
fi

# 3. Check for 'any' type in TypeScript
echo "Checking TypeScript types..."
if grep -r ": any" frontend/apps/ --include="*.ts" --include="*.tsx" | grep -v "// @ts-ignore" | grep -v ".d.ts"; then
    echo "‚ö†Ô∏è  Warning: Found 'any' types in TypeScript code"
fi

# 4. Testes
echo "Running tests..."
pytest --quiet || exit 1
npm test -- --silent || exit 1

# 5. Linting
echo "Checking code style..."
flake8 src/ || exit 1
eslint frontend/ || exit 1

# 6. Type checking
echo "Type checking..."
mypy src/ || exit 1
tsc --noEmit || exit 1

# 7. Security scan
echo "Security scan..."
bandit -r src/ || exit 1
npm audit || exit 1

# 8. Check for unused imports
echo "Checking imports..."
autoflake --check src/**/*.py || exit 1

# 9. Check for TODO/FIXME comments
echo "Checking for unresolved TODOs..."
TODO_COUNT=$(grep -r "TODO\|FIXME" src/ frontend/ --include="*.py" --include="*.ts" --include="*.tsx" | wc -l)
if [ $TODO_COUNT -gt 0 ]; then
    echo "‚ö†Ô∏è  Found $TODO_COUNT TODO/FIXME comments"
fi

echo "‚úÖ All checks passed!"
```

### Valida√ß√£o Manual

```markdown
## Checklist de Valida√ß√£o

### Funcionalidade

- [ ] Feature funciona conforme especificado
- [ ] ZERO bugs conhecidos na feature atual
- [ ] Todos os bugs encontrados foram corrigidos
- [ ] Edge cases tratados
- [ ] Erros tratados gracefully
- [ ] Performance aceit√°vel
- [ ] Testado com dados reais (n√£o apenas mocks)

### C√≥digo

- [ ] Sem warnings no console
- [ ] Sem imports n√£o utilizados
- [ ] Sem vari√°veis n√£o utilizadas
- [ ] Sem c√≥digo comentado
- [ ] Sem console.log/print debugs

### Testes

- [ ] Testes unit√°rios passando
- [ ] Testes de integra√ß√£o passando
- [ ] Coverage >= 70%
- [ ] Casos de erro testados

### Documenta√ß√£o

- [ ] README atualizado se necess√°rio
- [ ] API docs atualizados
- [ ] Changelog atualizado
- [ ] Coment√°rios em c√≥digo complexo

### Seguran√ßa

- [ ] Sem dados sens√≠veis hardcoded
- [ ] Input validation implementada
- [ ] SQL injection prevenido
- [ ] XSS prevenido
```

### Testes de Regress√£o

```bash
# Script para verificar se nada quebrou
#!/bin/bash

echo "üîÑ Running regression tests..."

# 1. Backend health check
curl -f http://localhost:8001/health || exit 1

# 2. Critical endpoints
curl -f http://localhost:8001/api/v1/products || exit 1
curl -f http://localhost:8001/api/v1/orders || exit 1

# 3. Frontend build
cd frontend && npm run build || exit 1

# 4. Database migrations
alembic check || exit 1

# 5. E2E critical paths
npm run test:e2e -- --grep="critical" || exit 1

echo "‚úÖ No regressions detected!"
```

---

## üöÄ Deploy e Release

### Processo de Deploy

```markdown
## Deploy Checklist

### Pre-Deploy

- [ ] Todos os testes passando
- [ ] Code review aprovado
- [ ] Documenta√ß√£o atualizada
- [ ] Version bump realizado
- [ ] Changelog atualizado

### Deploy Staging

- [ ] Deploy em staging
- [ ] Smoke tests passando
- [ ] Testes manuais realizados
- [ ] Performance verificada
- [ ] Logs sem erros

### Deploy Production

- [ ] Backup realizado
- [ ] Deploy em hor√°rio de baixo movimento
- [ ] Health checks passando
- [ ] Monitoring configurado
- [ ] Rollback plan pronto

### Post-Deploy

- [ ] Verifica√ß√£o de funcionalidades cr√≠ticas
- [ ] Monitoring por 24h
- [ ] Comunica√ß√£o com stakeholders
- [ ] Documenta√ß√£o de issues encontradas
```

### Rollback Plan

```bash
#!/bin/bash
# rollback.sh - Script de rollback r√°pido

PREVIOUS_VERSION=$1

if [ -z "$PREVIOUS_VERSION" ]; then
    echo "Usage: ./rollback.sh <version>"
    exit 1
fi

echo "‚ö†Ô∏è  Rolling back to version $PREVIOUS_VERSION"

# 1. Stop current deployment
docker-compose down

# 2. Checkout previous version
git checkout tags/v$PREVIOUS_VERSION

# 3. Restore database backup
./scripts/restore_db.sh $PREVIOUS_VERSION

# 4. Rebuild and deploy
docker-compose build
docker-compose up -d

# 5. Verify
./scripts/health_check.sh

echo "‚úÖ Rollback complete!"
```

---

## üîß Troubleshooting

### Problemas Comuns

#### Import Errors

```python
# Problema: ModuleNotFoundError
# Solu√ß√£o:
# 1. Verificar PYTHONPATH
export PYTHONPATH="${PYTHONPATH}:${PWD}"

# 2. Verificar estrutura de imports
# Use imports absolutos desde src/
from src.module.submodule import Component
```

#### Type Errors

```typescript
// Problema: Type 'undefined' is not assignable
// Solu√ß√£o:
// 1. Use optional chaining
const value = data?.property?.subproperty;

// 2. Use default values
const { name = "Default" } = props;

// 3. Type guards
if (isValidOrder(order)) {
  // order is typed correctly here
}
```

#### Performance Issues

```python
# Problema: N+1 queries
# Solu√ß√£o: Use eager loading
# ‚ùå BAD
orders = db.query(Order).all()
for order in orders:
    customer = db.query(Customer).filter_by(id=order.customer_id).first()

# ‚úÖ GOOD
orders = db.query(Order).options(
    joinedload(Order.customer)
).all()
```

### Debug Tips

```python
# Backend debugging
import pdb; pdb.set_trace()  # Breakpoint
import logging
logging.basicConfig(level=logging.DEBUG)

# SQL query logging
import logging
logging.getLogger('sqlalchemy.engine').setLevel(logging.INFO)
```

```typescript
// Frontend debugging
console.log({ data, state, props }); // Object logging
debugger; // Breakpoint

// React DevTools
if (process.env.NODE_ENV === "development") {
  console.log("Debug info:", { state });
}
```

---

## üìã Templates √öteis

### Novo M√≥dulo Template

```python
# src/new_module/__init__.py
"""New Module - Brief description."""

from .services import NewModuleService
from .models import NewModel

__all__ = ['NewModuleService', 'NewModel']
```

### Novo Componente Template

```typescript
// NewComponent.tsx
import React, { FC, memo } from "react";
import styles from "./NewComponent.module.css";

interface NewComponentProps {
  // Props definition
}

export const NewComponent: FC<NewComponentProps> = memo((props) => {
  // Implementation
  return <div className={styles.container}>{/* Content */}</div>;
});

NewComponent.displayName = "NewComponent";
```

### Test Template

```python
# test_template.py
import pytest
from unittest.mock import Mock, patch

class TestComponent:
    """Test suite for Component."""

    @pytest.fixture
    def component(self):
        """Create component instance."""
        return Component()

    def test_behavior(self, component):
        """Test expected behavior."""
        # Arrange
        expected = "expected_value"

        # Act
        result = component.method()

        # Assert
        assert result == expected
```

---

## üéØ Resumo - Regras de Ouro

### Os 32 Mandamentos do Desenvolvedor Chefia POS

1. **TERMINE O QUE COME√áOU - Uma tarefa por vez, 100% completa**
2. **NUNCA finalize uma tarefa com bugs conhecidos**
3. **Sempre crie TODO list antes de come√ßar**
4. **NUNCA deixe console.log/print no c√≥digo de produ√ß√£o**
5. **NUNCA use mocks fora de arquivos de teste**
6. **SEMPRE use tipagem forte (evite 'any' em TypeScript)**
7. **Commits pequenos e frequentes com mensagens descritivas**
8. **Teste localmente antes de fazer push**
9. **Documente o que voc√™ fez**
10. **Remova c√≥digo morto e imports n√£o usados observando os lint**
11. **Siga os padr√µes de c√≥digo estabelecidos**
12. **Escreva testes para seu c√≥digo (mocks s√≥ em testes!)**
13. **Valide que nada quebrou antes do commit**
14. **Use as pastas corretas para cada tipo de arquivo**
15. **Limpe todos os console.logs antes do commit**
16. **Garanta que tipos est√£o definidos em todas as fun√ß√µes**
17. **Pe√ßa code review antes de merge para main**
18. **Mantenha o padrao no nome de arquivos**
19. **Evite duplicacao de codigo, procure ver se j√° existe o que voce quer implementar**
20. **Crie codigos da forma mais simples possivel, evitando over-engineering**
21. **Tome cuidado com a quest√£o de seguran√ßa do codigo**
22. **Evitar alteracoes em lote por meio de scripts pois se perde o contexto**
23. **Lembrar de ter logs inteligentes no padr√£o j√° usado pelo projeto, que √© salvo localmente**
24. **Observar as an√°lises de qualidade de c√≥digo feitas pelos scripts de lint, audit, analize e verifica√ß√µes de sonar**
25. **SEMPRE substitua console.log por offlineStorage.log para logging centralizado**
26. **NUNCA deixe catch blocks vazios - sempre trate erros adequadamente**
27. **Use configura√ß√£o centralizada (config/api.ts) ao inv√©s de URLs hardcoded**
28. **Extraia nested ternary em fun√ß√µes nomeadas ou use IIFE pattern**
29. **Use elementos sem√¢nticos (button ao inv√©s de div clickable)**
30. **Implemente cache para evitar chamadas duplicadas √† API**
31. **Use optional chaining (?.) para acesso seguro a propriedades**
32. **Considere o uso de patterns como solid, event driven, domain-driven-design, clean code, saga, microfrontend, mobile first e outros**

### üö´ Os Pecados Capitais do Desenvolvimento

1. **Multitasking Ca√≥tico**: Come√ßar v√°rias tarefas sem terminar nenhuma
2. **Bug Debt**: Deixar bugs "para depois" e nunca corrigir
3. **Console.log Esquecido**: Deixar debug statements em produ√ß√£o
4. **Mock Selvagem**: Usar mocks fora de testes
5. **Any Pregui√ßoso**: Usar 'any' ao inv√©s de tipos apropriados
6. **Commit Monstro**: Commits gigantes com m√∫ltiplas features
7. **Copy-Paste Programming**: Duplicar c√≥digo ao inv√©s de reutilizar
8. **Documentation Debt**: N√£o documentar c√≥digo complexo
9. **"Funciona na Minha M√°quina"**: N√£o testar em ambiente limpo
10. **Catch Silencioso**: Blocos catch vazios que engolem erros
11. **URL Hardcoded**: URLs da API espalhadas pelo c√≥digo
12. **Nested Ternary Hell**: Operadores tern√°rios aninhados ileg√≠veis
13. **Div Clickable**: Usar div com onClick ao inv√©s de button
14. **API Spam**: M√∫ltiplas chamadas desnecess√°rias para a mesma API

### Scripts de Limpeza Autom√°tica

```bash
# clean-code.sh - Limpa c√≥digo antes do commit
#!/bin/bash

echo "üßπ Limpando c√≥digo..."

# Remove console.logs do TypeScript/JavaScript (preserve arquivos de teste)
find frontend -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" | \
  grep -v node_modules | \
  grep -v ".test." | \
  grep -v ".spec." | \
  xargs sed -i '/console\./d'

# Remove prints do Python (preserve arquivos de teste)
find src -name "*.py" | \
  grep -v tests | \
  grep -v test_ | \
  xargs sed -i '/print(/d'

# Verifica se h√° catch blocks vazios
echo "üîç Verificando catch blocks vazios..."
if grep -r "catch.*{[[:space:]]*}" frontend/ --include="*.ts" --include="*.tsx"; then
  echo "‚ùå Encontrados catch blocks vazios! Adicione tratamento de erro."
fi

# Verifica URLs hardcoded
echo "üîç Verificando URLs hardcoded..."
if grep -r "http://\|https://" frontend/apps/ --include="*.ts" --include="*.tsx" | grep -v "config/api" | grep -v ".test." | grep -v "README"; then
  echo "‚ö†Ô∏è  URLs hardcoded encontradas. Use config/api.ts"
fi

# Remove imports n√£o usados - Python
autoflake --in-place --remove-unused-variables --remove-all-unused-imports src/**/*.py

# Remove imports n√£o usados - TypeScript
eslint frontend --fix --ext .ts,.tsx,.js,.jsx

# Formata c√≥digo
black src/
prettier --write "frontend/**/*.{js,jsx,ts,tsx,css}"

echo "‚úÖ C√≥digo limpo!"
```

### Quick Commands

```bash
# Desenvolvimento di√°rio
make dev          # Inicia ambiente dev
make test         # Roda todos os testes
make lint         # Verifica c√≥digo
make format       # Formata c√≥digo
make validate     # Valida√ß√£o completa
make clean        # Limpa console.logs e prints

# Git workflow
git status
git add .
git commit -m "feat(module): description"
git push origin feature/branch

# Valida√ß√£o r√°pida antes do commit
./scripts/pre-commit.sh  # Roda todas as valida√ß√µes
./scripts/clean-code.sh  # Remove debug statements
```

---

## üí° Exemplo Pr√°tico: Desenvolvimento com Foco

### Cen√°rio: Implementar Sistema de Desconto

```markdown
## ‚ùå MODO ERRADO (Ca√≥tico)

09:00 - Come√ßa a criar modelo de desconto
09:15 - "Ah, deixa eu corrigir esse bug r√°pido no produto"
09:30 - "Vou aproveitar e refatorar essa fun√ß√£o"
10:00 - "Melhor j√° criar a UI do desconto tamb√©m"
10:30 - "Esse c√≥digo de pagamento est√° feio, vou melhorar"
11:00 - Ainda n√£o terminou NADA, 5 arquivos modificados
12:00 - Tenta fazer commit gigante, testes quebrados
Resultado: 0 features entregues, c√≥digo inst√°vel

## ‚úÖ MODO CORRETO (Focado)

### TODO List Criada:

1. [ ] Criar modelo de Discount
2. [ ] Criar service de c√°lculo
3. [ ] Adicionar endpoints API
4. [ ] Criar testes
5. [ ] Implementar UI
6. [ ] Integra√ß√£o e testes E2E

### Execu√ß√£o:

09:00 - FOCO: Modelo de Discount

- Cria classe Discount
- Define campos e valida√ß√µes
- Adiciona m√©todos b√°sicos
  09:45 - Testa modelo isoladamente
  09:50 - üêõ BUG ENCONTRADO: desconto negativo n√£o √© validado
  09:55 - CORRIGE o bug (adiciona valida√ß√£o)
  10:00 - Re-testa: agora sim est√° OK
  10:05 - Commit: "feat(discount): add discount model with validations"
  Status: Tarefa 1 ‚úÖ COMPLETA (sem bugs pendentes!)

10:15 - FOCO: Service de c√°lculo

- Implementa l√≥gica de c√°lculo
- Trata casos especiais
  11:00 - Testa service
  11:05 - üêõ BUG ENCONTRADO: divis√£o por zero em edge case
  11:10 - CORRIGE o bug (adiciona guard clause)
  11:15 - Re-testa todos os cen√°rios
  11:20 - Commit: "feat(discount): implement discount calculation service"
  Status: Tarefa 2 ‚úÖ COMPLETA (zero bugs conhecidos!)

Resultado √†s 12:00:

- 2 tarefas 100% completas
- 2 commits limpos e testados
- C√≥digo est√°vel e funcional
- Progresso mensur√°vel
```

### Comandos para Verificar Qualidade

```bash
# focus-check.sh - Verifica se voc√™ est√° focado
#!/bin/bash

# Quantos arquivos modificados?
MODIFIED=$(git status --porcelain | wc -l)

if [ $MODIFIED -gt 5 ]; then
    echo "‚ö†Ô∏è  ALERTA: $MODIFIED arquivos modificados!"
    echo "Voc√™ pode estar perdendo o foco."
    echo "Considere fazer commit do que est√° pronto"
    echo "e focar em uma √∫nica tarefa."
fi

# H√° quanto tempo sem commit?
LAST_COMMIT=$(git log -1 --format="%ar")
echo "üìù √öltimo commit: $LAST_COMMIT"

# Sugest√£o
echo "üí° Dica: Fa√ßa commits a cada 30-60 minutos"
echo "         Mantenha o foco em UMA tarefa por vez"
```

```bash
# bug-check.sh - Verifica bugs pendentes antes de finalizar
#!/bin/bash

echo "üêõ Verificando bugs pendentes..."

# Procura por TODOs relacionados a bugs
BUG_TODOS=$(grep -r "TODO.*bug\|TODO.*fix\|FIXME\|BUG\|HACK" src/ frontend/ --include="*.py" --include="*.ts" --include="*.tsx" | wc -l)

if [ $BUG_TODOS -gt 0 ]; then
    echo "‚ùå Encontrados $BUG_TODOS coment√°rios sobre bugs!"
    echo "Por favor, resolva antes de finalizar a tarefa."
    grep -r "TODO.*bug\|TODO.*fix\|FIXME\|BUG\|HACK" src/ frontend/ --include="*.py" --include="*.ts" --include="*.tsx"
    exit 1
fi

# Verifica se testes est√£o passando
echo "üß™ Rodando testes..."
pytest --quiet || { echo "‚ùå Testes falhando! Corrija antes de continuar."; exit 1; }
npm test -- --silent || { echo "‚ùå Testes JS falhando!"; exit 1; }

# Verifica console statements (devem usar offlineStorage.log)
if grep -r "console\." frontend/ --include="*.ts" --include="*.tsx" | grep -v ".test." | grep -v ".spec." | grep -v "// eslint-disable"; then
    echo "‚ùå console.* encontrado! Use offlineStorage.log para logging centralizado."
    echo "Exemplo: offlineStorage.log('Error message', error);"
    exit 1
fi

# Verifica catch blocks vazios
if grep -r "catch.*{[[:space:]]*}" frontend/ --include="*.ts" --include="*.tsx" | grep -v ".test."; then
    echo "‚ùå Catch blocks vazios encontrados! Sempre trate erros adequadamente."
    exit 1
fi

# Verifica URLs hardcoded
if grep -r "http[s]*://[^'\"]*['\"]" frontend/apps/ --include="*.ts" --include="*.tsx" | grep -v "config/api" | grep -v ".test." | head -5; then
    echo "‚ö†Ô∏è  URLs hardcoded encontradas. Centralize em config/api.ts"
fi

echo "‚úÖ Nenhum bug √≥bvio detectado!"
echo "üìã Lembre-se de testar manualmente:"
echo "   - Casos normais"
echo "   - Edge cases (valores extremos)"
echo "   - Inputs inv√°lidos"
echo "   - Condi√ß√µes de erro"
```

---

## üìû Contatos e Recursos

- **Documenta√ß√£o**: `/docs`
- **Issues**: GitHub Issues
- **Wiki**: Confluence/Notion
- **Slack**: #chefia-pos-dev

### Leitura Recomendada sobre Produtividade

- "Deep Work" - Cal Newport
- "The Pragmatic Programmer" - David Thomas
- "Clean Code" - Robert C. Martin
- "Getting Things Done" - David Allen

---

_√öltima atualiza√ß√£o: 2024_
_Vers√£o: 1.1.0_
_Changelog: Adicionado foco e gest√£o de tarefas √∫nicas_
